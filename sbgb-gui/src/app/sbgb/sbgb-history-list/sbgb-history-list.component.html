<div class="history-container">
  <h2>Bibliothèque des ciels étoilés</h2>

  @if (visibleBases.length === 0) {
    <div class="empty-message">
      Aucun ciel étoilé enregistré. Créez votre premier ciel étoilé !
    </div>
  } @else {
    <mat-accordion multi="false">
      @for (base of visibleBases; track base.id) {
        <mat-expansion-panel (opened)="onBaseExpanded(base.id)">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ base.description }}
            </mat-panel-title>
            <mat-panel-description>
              <div class="stars">
                @for (star of starValues; track star) {
                  <mat-icon [style.color]="isFilled(star, base.maxNote) ? '#ffd740' : 'rgba(255,255,255,0.3)'"
                            style="font-size:1.2rem;width:1.2rem;height:1.2rem">
                    {{ isFilled(star, base.maxNote) ? 'star' : 'star_border' }}
                  </mat-icon>
                }
              </div>
              @if (base.noiseType) {
                <span class="type-badge">{{ base.noiseType }}</span>
              }
            </mat-panel-description>
          </mat-expansion-panel-header>

          <div class="renders-grid">
            @for (render of rendersFor(base.id); track render.id) {
              <div class="render-card"
                   (click)="onRenderSelected(render)"
                   [matTooltip]="render.description">
                @if (render.thumbnail) {
                  <img [src]="'data:image/png;base64,' + render.thumbnail" [alt]="render.description">
                }
                <div class="render-overlay">
                  <div class="render-note">
                    <mat-icon inline>star</mat-icon>
                    {{ render.note }}
                  </div>
                  <button mat-icon-button color="warn"
                          (click)="onDeleteRender(render.id); $event.stopPropagation()"
                          matTooltip="Supprimer ce rendu">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            }
          </div>

          <mat-action-row>
            <button mat-button color="primary" (click)="onLoadBestRender(base.id)">
              <mat-icon>edit</mat-icon>
              Charger dans le générateur
            </button>
          </mat-action-row>
        </mat-expansion-panel>
      }
    </mat-accordion>
  }
</div>
